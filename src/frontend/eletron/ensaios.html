<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="./style.css">
</head>
<body onload="getRoutes()">
    <button onclick="window.location.href='index.html'">Voltar</button>

    <div class="container">
        
        <div class="row d-flex justify-content-left">            
            <div id="buttonsMain" class="col-sm">
                <div class="p-2"><button class="btn btn-primary btn-lg" onclick="makePostRequest('rodar')">Iniciar ensaio padrão</button></div>
                <!-- arrow down -->
                <div class="p-2"><button class="btn btn-primary btn-lg" onclick="newRoute()">Gravar nova rota</button></div>
            </div>

            <div class="col-sm">
                <div class="row">
                    <div class="col">
                        <table class="table table-striped" id="routes">
                            <thead>
                                <tr>
                                    <th scope="col">Nome</th>
                                    <th scope="col">Descrição</th>
                                    <th scope="col">Selecionar</th>
                                    <th scope="col">Editar</th>
                                    <th scope="col">Excluir</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Nome da rota</td>
                                    <td>Descrição da rota</td>
                                    <td><button class="btn btn-primary">Selecionar</button></td>
                                    <td><button class="btn btn-primary">Editar</button></td>
                                    <td><button class="btn btn-primary">Excluir</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="p-2 col">
                            <button class="btn btn-primary" onclick="makePostRequest('rodar')">Rodar rota selecionada</button>
                    </div>
                </div>
            </div>
        </div>


    </div>


    
    
</body>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    // body onload get all routes from database
    getRoutes = () => {
        console.log("getRoutes")
        axios.get('http://localhost:5000/robot/getroutes')
        .then(function (response) {
            console.log(response.data);
            // populate the table with the routes
            let routes = document.getElementById('routes');
            for (let i = 0; i < response.data.length; i++) {
                let route = response.data[i];
                let row = document.createElement('tr');
                let name = document.createElement('td');
                let description = document.createElement('td');
                let select = document.createElement('td');
                let edit = document.createElement('td');
                let deleteRoute = document.createElement('td');
                name.innerHTML = route.name;
                description.innerHTML = route.description;
                select.innerHTML = '<button class="btn btn-primary">Selecionar</button>';
                edit.innerHTML = '<button class="btn btn-primary">Editar</button>';
                deleteRoute.innerHTML = '<button class="btn btn-primary">Excluir</button>';
                row.appendChild(name);
                row.appendChild(description);
                row.appendChild(select);
                row.appendChild(edit);
                row.appendChild(deleteRoute);
                routes.appendChild(row);
            }
        })
        .catch(function (error) {
            console.log(error);
        });
    }


    test = 'Hello'
    async function makePostRequest(test) {
    axios.post('http://localhost:5000/robot', test)
    .then(function (response) {
    console.log("It says: " + response.data);
    })
    .catch(function (error) {
    console.log(error);
    });
    }

    // checks if there is a form already created, if not, create one
    function newRoute(){
        let buttonsMain = document.getElementById('buttonsMain');
        let divContainer = document.getElementById('divContainer');
        if (divContainer == null){
            newRouteCreate();
        } else {
            buttonsMain.removeChild(divContainer);
            // newRouteCreate();
        }
    }

    // when clicks on "gravar nova rota", insert form inputs into html, below id "buttonsMain"  

    function newRouteCreate(){
        let buttonsMain = document.getElementById('buttonsMain');
        let divContainer = document.createElement('div');
        divContainer.setAttribute('class', 'row');
        divContainer.setAttribute('id', 'divContainer');

        let divForm = document.createElement('div');
        divForm.setAttribute('class', 'col-sm');
        let form = document.createElement('form');

        let divName = document.createElement('div');
        divName.setAttribute('class', 'form-group');
        let labelName = document.createElement('label');
        labelName.setAttribute('for', 'name');
        labelName.innerHTML = 'Nome da rota';
        let inputName = document.createElement('input');
        inputName.setAttribute('type', 'text');
        inputName.setAttribute('class', 'form-control');
        inputName.setAttribute('id', 'name');
        inputName.setAttribute('placeholder', 'Nome da rota');
        divName.appendChild(labelName);
        divName.appendChild(inputName);

        let divDescription = document.createElement('div');
        divDescription.setAttribute('class', 'form-group');
        let labelDescription = document.createElement('label');
        labelDescription.setAttribute('for', 'description');
        labelDescription.innerHTML = 'Descrição da rota';
        let inputDescription = document.createElement('input');
        inputDescription.setAttribute('type', 'text');
        inputDescription.setAttribute('class', 'form-control');
        inputDescription.setAttribute('id', 'description');
        inputDescription.setAttribute('placeholder', 'Descrição da rota');
        divDescription.appendChild(labelDescription);
        divDescription.appendChild(inputDescription);

        // row for buttons, so they are side by side
        let divRowButtons = document.createElement('div');
        divRowButtons.setAttribute('class', 'row');

        // button to add nodes that runs a function x()
        let divAddNode = document.createElement('div');
        divAddNode.setAttribute('class', 'col-sm');
        let buttonAddNode = document.createElement('button');
        buttonAddNode.setAttribute('class', 'btn btn-primary');
        buttonAddNode.setAttribute('type', 'button')
        buttonAddNode.setAttribute('onclick', 'addNodePost()');
        buttonAddNode.innerHTML = 'Adicionar ponto';
        divAddNode.appendChild(buttonAddNode);

        // button to save route
        let divSaveRoute = document.createElement('div');
        divSaveRoute.setAttribute('class', 'col-sm');
        let buttonSaveRoute = document.createElement('button');
        buttonSaveRoute.setAttribute('class', 'btn btn-primary');
        buttonSaveRoute.setAttribute('type', 'subtmit');
        buttonSaveRoute.innerHTML = 'Salvar rota';
        divSaveRoute.appendChild(buttonSaveRoute);

        form.appendChild(divName);
        form.appendChild(divDescription);
        form.appendChild(divRowButtons);
        divRowButtons.appendChild(divAddNode);
        divRowButtons.appendChild(divSaveRoute);
        divForm.appendChild(form);
        divContainer.appendChild(divForm);
        buttonsMain.appendChild(divContainer);
    }
</script>
</html>